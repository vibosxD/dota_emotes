<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">

  <title>Dota 2 Emotes</title>
  <meta name="description" content="Dota 2 Emotes">
  <meta name="author" content="Valve">
  <style>
    body {
      background-color: black;
      color: white;
    }

    div {
      margin: 5px;
    }

    span {
      margin: 10px;
    }
  </style>
</head>

<body>
  <h1>
    Copy the string next to the emote name "" and use it in the console "say "
  </h1>
</body>

<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', init)
  async function init() {
    const data = (await (await fetch('./emoticons.json')).json())
    const emoticons = data.emoticons
    console.log(emoticons)
    for (const emoteId in emoticons) {
      const imageName = emoticons[emoteId].image_name
      const msPerFrame = emoticons[emoteId].ms_per_frame
      const div = document.createElement('div')
      const text = document.createElement('div')
      const canvas = document.createElement('canvas')
      canvas.height = 64
      canvas.width = 64
      const ctx = canvas.getContext('2d')
      text.innerText = `:${imageName.replace('.png', '')}: - ${String.fromCharCode(57345 + Number(emoteId) - 1)}`
      div.appendChild(text)
      const img = new Image()
      img.onload = () => draw(canvas, ctx, img, 0, msPerFrame, Infinity)
      img.src = `emoticons/${imageName}`.replace('.png', '_png.png')
      div.appendChild(canvas)
      document.body.appendChild(div)
    }

    function draw(canvas, ctx, img, i, msPerFrame, tick) {
      const height = img.height
      const width = img.width // height===width
      // Draw static images single time
      if (img.height === img.width) return ctx.drawImage(img, 0, 0, height, height, 0, 0, height * 1.5, height * 1.5)
      // Do nothing if not time to re-draw next frame
      if (tick < msPerFrame / (1000 / 60)) { // Assuming 60 fps :(
        return window.requestAnimationFrame(() => draw(canvas, ctx, img, i, msPerFrame, tick + 1))
      } else {
        tick = 0
      }
      // Start over if at end of tile
      if (i * height >= width) i = 0
      ctx.clearRect(0, 0, canvas.width, canvas.height)
      ctx.drawImage(img, i * height, 0, height, height, 0, 0, height * 1.5, height * 1.5)
      window.requestAnimationFrame(() => draw(canvas, ctx, img, i + 1, msPerFrame, tick + 1))
    }
  }
</script>

</html>
